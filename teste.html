<!DOCTYPE html>
<html>

  <script>
    window.onload = function () {
      function updateBatteryStatus(battery) {
        document.querySelector('#charging').textContent = battery.charging ? 'charging' : 'not charging';
        document.querySelector('#level').textContent = battery.level * 100 + "%";
        document.querySelector('#dischargingTime').textContent = battery.dischargingTime / 60 + " minutes";
		document.querySelector('#location').textContent = currentPosition();
		
		 
		
	}
		function currentPosition(){
			if (!navigator.geolocation){
				alert("Geolocation is not supported by your browser");
			}
			else{
				function success(position) {
					var latitude  = position.coords.latitude;
					var longitude = position.coords.longitude;
					var msg = "Olá eu acabei de me acidentar no seguinte endereço: ";
					if(navigator.onLine){
						var geocoder = new google.maps.Geocoder;
						
						var latlng = {lat: parseFloat(latitude), lng: parseFloat(longitude)};
						geocoder.geocode({'location': latlng}, function(results, status) {
						if (status === google.maps.GeocoderStatus.OK) {
						  if (results[1]) {
							msg += results[1].formatted_address;
							document.querySelector('#location').textContent = msg;
						  
							var msgSpeech = new SpeechSynthesisUtterance(msg);
							window.speechSynthesis.speak(msgSpeech);
						  
						  } else {
							window.alert('No results found');
						  }
						} else {
						  window.alert('Geocoder failed due to: ' + status);
						}
						});
						
					}
					else{
						msg += "Latitude: " + latitude + "   Longitude: " + longitude;
						alert("Estou offline");
						document.querySelector('#location').textContent = msg;
						var msgSpeech = new SpeechSynthesisUtterance(msg);
						window.speechSynthesis.speak(msgSpeech);
					}
				}
				function error() {
					alert("Unable to retrieve your location");
				};

				  //alert("Locating…");

				  navigator.geolocation.getCurrentPosition(success, error);
			}
			
		}

      navigator.getBattery().then(function(battery) {
        // Update the battery status initially when the promise resolves ...
        updateBatteryStatus(battery);

        // .. and for any subsequent updates.
        battery.onchargingchange = function () {
          updateBatteryStatus(battery);
        };

        battery.onlevelchange = function () {
          updateBatteryStatus(battery);
        };

        battery.ondischargingtimechange = function () {
          updateBatteryStatus(battery);
        };
      });
    };
  </script>
  
  
<!-- Maps API Javascript -->
<!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5nAx_lxyFF3ZQHXd1PGf-PmGUzczDAU8&sensor=false&libraries=places""></script>
-->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5nAx_lxyFF3ZQHXd1PGf-PmGUzczDAU8"></script>

<head>
  <title>SaveMe</title>
</head>
<body>
  <div id="charging"></div>
  <div id="level"></div>
  <div id="dischargingTime"></div>
  <br><br>
  <div id="location"></div>
  <br><br>
  <a href="tel:193">Ligue agora para os bombeiros</a>
</body>
</html>